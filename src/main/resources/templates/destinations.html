<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Découvrez nos offres de voyage autour du monde !">
  <meta name="keywords" content="voyage, tourisme, vacances">
  <meta name="author" content="Younes Achouche, Zayd Ajjaji, Lucas Colussi, Mehdi El Kadaoui, Daniele Sandra Tonfack Yonta">
  <title>Voyages - Evazion</title>
  <link rel="icon" type="image/x-icon" href="/assets/evazion-logo.png">
  <link rel="stylesheet" href="/styles/base.css">
  <link rel="stylesheet" href="/styles/header.css">
  <link rel="stylesheet" href="/styles/footer.css">
  <link rel="stylesheet" href="/styles/scroll-top-button.css">
  <link rel="stylesheet" href="/styles/notification.css">
  <link rel="stylesheet" href="/styles/voyages.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <script src="/script/notification.js"></script>
</head>
<body>
<header class="header">
  <div class="top-bar">
    <div class="logo">
      <a th:href="@{/}">
        Evazion
      </a>
    </div>
    <ul class="navigation">
      <li class="navigation-item trips-item">
        <a th:href="@{/destinations}">Voyages</a>
      </li>
      <li class="navigation-item">
        <a th:href="@{/reviews}">Avis</a>
      </li>
      <li class="navigation-item">
        <a th:href="@{/contact}">Contact</a>
      </li>
      <li class="navigation-item buttons-container">
        <a th:href="@{/users/user-profile}" class="navigation-item account">
          <i class="fa-solid fa-user"></i> Compte
        </a>
      </li>
    </ul>
  </div>
</header>

<!--/*@thymesVar id="successMessageCreateDestination" type="java"*/-->
<p class="notification" th:if="${successMessageCreateDestination}">
  <i class="fa-solid fa-plus"></i>
  <span th:text="${successMessageCreateDestination}"></span>
</p>

<!--/*@thymesVar id="successMessageUpdateDestination" type="java"*/-->
<p class="notification" th:if="${successMessageUpdateDestination}">
  <i class="fa-solid fa-pen"></i>
  <span th:text="${successMessageUpdateDestination}"></span>
</p>

<!--/*@thymesVar id="successMessageDeleteDestination" type="java"*/-->
<p class="notification" th:if="${successMessageDeleteDestination}">
  <i class="fa-solid fa-trash"></i>
  <span th:text="${successMessageDeleteDestination}"></span>
</p>

<section class="main-section">
  <h1 class="section-title">Voyages</h1>
  <p class="section-description"></p>
  <div class="menu">
    <div class="menu-item">
      <h5 class="menu-item-title">Continent</h5>
      <select name="continent">
        <option selected>Tous</option>
        <option>Afrique</option>
        <option>Amérique du Nord</option>
        <option>Amérique du Sud</option>
        <option>Asie</option>
        <option>Europe</option>
      </select>
    </div>
    <div class="menu-item">
      <h5 class="menu-item-title">Pays</h5>
      <select name="pays">
        <option selected>Tous</option>
        <option>Afghanistan</option>
        <option>Afrique du Sud</option>
        <option>Albanie</option>
        <option>Algérie</option>
        <option>Allemagne</option>
        <option>Andorre</option>
        <option>Angola</option>
        <option>Antigua-et-Barbuda</option>
        <option>Arabie Saoudite</option>
        <option>Argentine</option>
        <option>Arménie</option>
        <option>Australie</option>
        <option>Autriche</option>
        <option>Azerbaïdjan</option>
        <option>Bahamas</option>
        <option>Bahreïn</option>
        <option>Bangladesh</option>
        <option>Barbade</option>
        <option>Belau / Palau / Palaos</option>
        <option>Belgique</option>
        <option>Belize</option>
        <option>Bénin</option>
        <option>Bhoutan</option>
        <option>Biélorussie</option>
        <option>Birmanie</option>
        <option>Bolivie</option>
        <option>Bosnie-Herzégovine</option>
        <option>Botswana</option>
        <option>Brésil</option>
        <option>Brunei</option>
        <option>Bulgarie</option>
        <option>Burkina Faso</option>
        <option>Burundi</option>
        <option>Cambodge</option>
        <option>Cameroun</option>
        <option>Canada</option>
        <option>Cap-Vert</option>
        <option>Centrafrique</option>
        <option>Chili</option>
        <option>Chine</option>
        <option>Chypre</option>
        <option>Colombie</option>
        <option>Comores</option>
        <option>Congo-Brazzaville</option>
        <option>Congo-Kinshasa</option>
        <option>Corée du Nord</option>
        <option>Corée du Sud</option>
        <option>Costa Rica</option>
        <option>Côte d’Ivoire</option>
        <option>Croatie</option>
        <option>Cuba</option>
        <option>Danemark</option>
        <option>Djibouti</option>
        <option>Dominique</option>
        <option>Égypte</option>
        <option>Émirats arabes unis</option>
        <option>Équateur</option>
        <option>Érythrée</option>
        <option>Espagne</option>
        <option>Estonie</option>
        <option>États-Unis</option>
        <option>Éthiopie</option>
        <option>Fidji</option>
        <option>Finlande</option>
        <option>France</option>
        <option>Gabon</option>
        <option>Gambie</option>
        <option>Géorgie</option>
        <option>Ghana</option>
        <option>Grèce</option>
        <option>Grenade</option>
        <option>Guatemala</option>
        <option>Guinée-Bissau</option>
        <option>Guinée-Conakry</option>
        <option>Guinée équatoriale</option>
        <option>Guyana</option>
        <option>Haïti</option>
        <option>Honduras</option>
        <option>Hongrie</option>
        <option>Inde</option>
        <option>Indonésie</option>
        <option>Irak</option>
        <option>Iran</option>
        <option>Irlande</option>
        <option>Islande</option>
        <option>Israël</option>
        <option>Italie</option>
        <option>Jamaïque</option>
        <option>Japon</option>
        <option>Jordanie</option>
        <option>Kazakhstan</option>
        <option>Kenya</option>
        <option>Kirghizistan</option>
        <option>Kiribati</option>
        <option>Kosovo</option>
        <option>Koweït</option>
        <option>Laos</option>
        <option>Lesotho</option>
        <option>Lettonie</option>
        <option>Liban</option>
        <option>Liberia</option>
        <option>Libye</option>
        <option>Liechtenstein</option>
        <option>Lituanie</option>
        <option>Luxembourg</option>
        <option>Macédoine</option>
        <option>Madagascar</option>
        <option>Malaisie</option>
        <option>Malawi</option>
        <option>Maldives</option>
        <option>Mali</option>
        <option>Malte</option>
        <option>Maroc</option>
        <option>Marshall</option>
        <option>Maurice</option>
        <option>Mauritanie</option>
        <option>Mexique</option>
        <option>Micronésie</option>
        <option>Moldavie</option>
        <option>Monaco</option>
        <option>Mongolie</option>
        <option>Monténégro</option>
        <option>Mozambique</option>
        <option>Namibie</option>
        <option>Nauru</option>
        <option>Népal</option>
        <option>Nicaragua</option>
        <option>Niger</option>
        <option>Nigeria</option>
        <option>Norvège</option>
        <option>Nouvelle-Zélande</option>
        <option>Oman</option>
        <option>Ouganda</option>
        <option>Ouzbékistan</option>
        <option>Pakistan</option>
        <option>Panama</option>
        <option>Papouasie-Nouvelle-Guinée</option>
        <option>Paraguay</option>
        <option>Pays-Bas</option>
        <option>Pérou</option>
        <option>Philippines</option>
        <option>Pologne</option>
        <option>Portugal</option>
        <option>Qatar</option>
        <option>République dominicaine</option>
        <option>République tchèque</option>
        <option>Roumanie</option>
        <option>Royaume-Uni</option>
        <option>Russie</option>
        <option>Rwanda</option>
        <option>Saint-Christophe-et-Niévès</option>
        <option>Sainte-Lucie</option>
        <option>Saint-Marin</option>
        <option>Saint-Vincent-et-les-Grenadines</option>
        <option>Salomon</option>
        <option>São-Tomé-et-Príncipe</option>
        <option>Salvador</option>
        <option>Samoa occidentales</option>
        <option>Sénégal</option>
        <option>Serbie</option>
        <option>Seychelles</option>
        <option>Sierra Leone</option>
        <option>Singapour</option>
        <option>Slovaquie</option>
        <option>Slovénie</option>
        <option>Somalie</option>
        <option>Soudan</option>
        <option>Soudan du Sud</option>
        <option>Sri Lanka</option>
        <option>Suède</option>
        <option>Suisse</option>
        <option>Surinam</option>
        <option>Swaziland</option>
        <option>Syrie</option>
        <option>Tadjikistan</option>
        <option>Tanzanie</option>
        <option>Tchad</option>
        <option>Timor oriental</option>
        <option>Thaïlande</option>
        <option>Togo</option>
        <option>Tonga</option>
        <option>Trinité-et-Tobago</option>
        <option>Tunisie</option>
        <option>Turkménistan</option>
        <option>Turquie</option>
        <option>Tuvalu</option>
        <option>Ukraine</option>
        <option>Uruguay</option>
        <option>Vanuatu</option>
        <option>Vatican</option>
        <option>Venezuela</option>
        <option>Vietnam</option>
        <option>Yémen</option>
        <option>Zambie</option>
        <option>Zimbabwe</option>
      </select>
    </div>
    <div class="menu-item">
      <h5 class="menu-item-title">Durée du séjour</h5>
      <select name="price">
        <option selected>Tous</option>
        <option>Escapade courte (4 à 6 jours)</option>
        <option>Séjour de une semaine (7 à 8 jours)</option>
        <option>Voyage prolongé (9 à 11 jours)</option>
        <option>Long séjour (12 à 15 jours)</option>
      </select>
    </div>
    <div class="menu-item">
      <h5 class="menu-item-title">Date de départ</h5>
      <input type="date" name="startDateUser" class="date-picker" />
    </div>
    <div class="menu-item">
      <h5 class="menu-item-title">Date de fin</h5>
      <input type="date" name="endDateUser" class="date-picker" />
    </div>
    <div class="menu-item">
      <h5 class="menu-item-title">Budget par personne</h5>
      <select name="budget">
        <option selected>Tous</option>
        <option>Moins de 1000 €</option>
        <option>De 1000 € à 3000 €</option>
        <option>De 3000 € à 5000 €</option>
        <option>De 5000 € à 7000 €</option>
        <option>Plus de 7000 €</option>
      </select>
    </div>
  </div>
  <div class="list">
    <a th:each="destination : ${destinations}" class="card" th:href="@{/destinations/{id}(id=${destination.destinationId})}">
      <img th:src="@{/images/{urlImage}(urlImage=${destination.lienImage})}" alt="Image de la destination" class="card-image"/>
      <div class="card-content">
        <div class="card-header">
          <div class="infos">
            <span th:text="${T(java.lang.Math).round(destination.price) + ' €'}" class="price">Prix</span>
            <span class="duration">
                <span th:text="${#dates.format(destination.startDate, 'dd/MM/yyyy')} + ' - ' + ${#dates.format(destination.endDate, 'dd/MM/yyyy')}"></span>
            </span>
          </div>
        </div>
        <div class="card-footer">
          <h4 class="location">
            <i class="fa-solid fa-map-pin"></i>
            <span th:text="${destination.city}">Ville</span>,
            <span th:text="${destination.country}">Pays</span>
          </h4>
        </div>
      </div>
    </a>
  </div>
</section>
<footer class="footer">
  <div class="footer-content">
    <div class="footer-top">
      <h3>Evazion</h3>
      <p>Evazion propose des voyages sur mesure pour des escapades uniques, mêlant aventure, détente et découvertes culturelles. Faites confiance à notre expertise pour transformer vos envies d’évasion en souvenirs mémorables, où que vos rêves vous mènent.</p>
    </div>
    <div class="footer-center">
      <div class="footer-center-section">
        <h3>Accès rapide</h3>
        <ul class="pages">
          <li>
            <a th:href="@{/about-us}">Qui sommes-nous ?</a>
          </li>
          <li>
            <a th:href="@{/faq}">Foire aux questions</a>
          </li>
          <li>
            <a th:href="@{/reviews}">Avis</a>
          </li>
        </ul>
      </div>
      <div class="footer-center-section">
        <h3>Contactez-nous</h3>
        <ul class="contact">
          <li>
            <i class="fa-solid fa-phone"></i> +33 1 23 45 67 89
          </li>
          <li>
            <a href="mailto:contact@evazion.com" target="_blank"><i class="fa-solid fa-envelope"></i> contact@evazion.com</a>
          </li>
          <li>
            <a href="https://www.facebook.com/" target="_blank"><i class="fa-brands fa-facebook"></i> Evazion - Agence de voyage</a>
          </li>
          <li>
            <a href="https://www.instagram.com/" target="_blank"><i class="fa-brands fa-instagram"></i> evazionvoyages</a>
          </li>
        </ul>
      </div>
      <div class="footer-center-section">
        <h3>Partenaires</h3>
        <ul class="partners">
          <li>SkyLynx Airways</li>
          <li>Aurora Haven</li>
          <li>Pathfinders Collective</li>
        </ul>
      </div>
    </div>
    <hr>
    <div class="footer-bottom">
      <ul class="documents">
        <li>
          <a th:href="@{/politique-de-confidentialite}">Politique de confidentialité</a>
        </li>
        <li>
          <a th:href="@{/cgv}">Conditions générales de ventes</a>
        </li>
      </ul>
      <p>© 2024 Evazion - Tous droits réservés.</p>
    </div>
  </div>
</footer>
<a href="#" class="scroll-top-button">
  <i class="fa-solid fa-arrow-up"></i>
</a>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filters = document.querySelectorAll('.menu-item select, .menu-item input');
    const destinationList = document.querySelector('.list');

    if (!destinationList) {
      console.error('Element destinationList non trouvé.');
      return;
    }

    const fetchDestinations = () => {
      const params = new URLSearchParams();

      filters.forEach(f => {
        if (f.value !== 'Tous' && f.value !== '') {
          // Si c'est la date de départ, ajoute un paramètre startDateUser
          if (f.name === "startDateUser") {
            params.append("startDateUser", f.value);  // Ajoute le paramètre startDateUser
          }
          // Si c'est la date de fin, ajoute un paramètre endDateUser
          else if (f.name === "endDateUser") {
            params.append("endDateUser", f.value);  // Ajoute le paramètre endDateUser
          }
          // Si c'est la durée, utilise un nom spécifique pour ce paramètre
          else if (f.name === "price") {
            params.append("duration", f.value);  // Ajoute le paramètre duration
          } else {
            params.append(f.name, f.value);  // Ajoute les autres paramètres
          }
        }
      });

      console.log("Params being sent:", params.toString());  // Affiche les paramètres envoyés dans l'URL

      const url = `/destinations/filter?${params.toString()}`;
      console.log("Fetching data from:", url);  // Affiche l'URL complète de la requête

      fetch(url)
              .then(response => {
                if (!response.ok) {
                  console.error('Erreur dans la réponse:', response.statusText);
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json(); // Convertir la réponse en JSON
              })
              .then(data => {
                console.log('Destinations:', data);

                destinationList.innerHTML = '';

                if (data.length > 0) {
                  data.forEach(destination => {
                    const card = document.createElement('a');
                    card.classList.add('card');
                    card.href = '#';
                    card.innerHTML = `
              <img src="/images/${destination.lienImage}" alt="Image de la destination" class="card-image"/>
              <div class="card-content">
                <div class="card-header">
                  <div class="infos">
                    <span class="price">${destination.price}€</span>
                    <span class="duration">${destination.startDate} - ${destination.endDate}</span>
                  </div>
                </div>
                <div class="card-footer">
                  <h4 class="location">
                    <i class="fa-solid fa-map-pin"></i>
                    ${destination.city}, ${destination.country}
                  </h4>
                </div>
              </div>
            `;
                    destinationList.appendChild(card);
                  });
                } else {
                  destinationList.innerHTML = '<p>Aucune destination trouvée.</p>';
                }
              })
              .catch(error => {
                console.error('Erreur lors du chargement des destinations :', error);
                destinationList.innerHTML = '<p>Une erreur est survenue lors du chargement des destinations. Veuillez réessayer plus tard.</p>';
              });
    };

    filters.forEach(filter => {
      filter.addEventListener('change', () => {
        fetchDestinations();
      });
    });
  });
</script>
</body>
</html>
